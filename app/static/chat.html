<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure Azure Vending Machine</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='image/favicon.ico') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked@5.1.1/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="logo">
                <i class="fas fa-robot"></i>
                <h1>Azure Architecture Vending Machine</h1>
            </div>
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Initializing...</span>
            </div>
        </header>

        <input type="hidden" id="clientId" value="{{ client_id }}">
        <input type="hidden" id="enableWebSockets" value="{{ enable_websockets }}">

        <!-- Hidden Configuration Panel -->
        <div id="configuration" style="display: none;">
            <h2>Chat Configuration</h2>
            <label for="azureOpenAIDeploymentName">Azure OpenAI Deployment Name:</label>
            <input id="azureOpenAIDeploymentName" value="gpt-4.1-mini" type="text" />
            <label for="prompt">System Prompt:</label>
            <textarea id="prompt">You are an AI assistant that helps people find information. You MUST speak in Korean. When responding, make sure to output \n appropriately. Since this will be used for TTS speech, respond in a friendly, conversational tone.</textarea>
            <div>
                <input type="checkbox" id="enableOyd" onchange="window.updataEnableOyd()">
                <label for="enableOyd">Enable On Your Data</label>
            </div>

            <div id="cogSearchConfig" hidden="hidden">
                <label for="azureCogSearchIndexName">Azure Cognitive Search Index Name:</label>
                <input id="azureCogSearchIndexName" type="text" />
            </div>

            <h3>Speech Configuration</h3>
            <label for="sttLocales">STT Locale(s):</label>
            <input id="sttLocales" type="text" value="ko-KR">
            <label for="ttsVoice">TTS Voice:</label>
            <input id="ttsVoice" type="text" value="ko-KR-SunHiNeural">
            <label for="customVoiceEndpointId">Custom Voice Deployment ID:</label>
            <input id="customVoiceEndpointId" type="text" value="">
            <label for="personalVoiceSpeakerProfileID">Personal Voice Speaker Profile ID:</label>
            <input id="personalVoiceSpeakerProfileID" type="text" value="">
            <div>
                <input type="checkbox" id="continuousConversation" checked>
                <label for="continuousConversation">Continuous Conversation</label>
            </div>

            <h3>Avatar Configuration</h3>
            <label for="talkingAvatarCharacter">Avatar Character:</label>
            <input id="talkingAvatarCharacter" type="text" value="lisa">
            <label for="talkingAvatarStyle">Avatar Style:</label>
            <input id="talkingAvatarStyle" type="text" value="casual-sitting">
            <div>
                <input type="checkbox" id="customizedAvatar">
                <label for="customizedAvatar">Custom Avatar</label>
            </div>
            <div>
                <input type="checkbox" id="autoReconnectAvatar">
                <label for="autoReconnectAvatar">Auto Reconnect</label>
            </div>
            <div>
                <input type="checkbox" id="useLocalVideoForIdle" onchange="window.updateLocalVideoForIdle()">
                <label for="useLocalVideoForIdle">Use Local Video for Idle</label>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Control Panel -->
            <div class="control-panel">
                <button id="startSession" onclick="window.startSession()" class="control-btn primary" title="Start Avatar Session">
                    <i class="fas fa-play"></i>
                    <span>Start Session</span>
                </button>
                
                <button id="microphone" onclick="window.microphone()" disabled class="control-btn" title="Toggle Microphone">
                    <i class="fas fa-microphone"></i>
                    <span>Microphone</span>
                </button>
                
                <button id="stopSpeaking" onclick="stopSpeaking()" disabled class="control-btn danger" title="Stop Speaking">
                    <i class="fas fa-stop"></i>
                    <span>Stop</span>
                </button>
                
                <button id="clearChatHistory" onclick="window.clearChatHistory()" class="control-btn secondary" title="Clear Chat History">
                    <i class="fas fa-trash-alt"></i>
                    <span>Clear</span>
                </button>
                
                <button id="stopSession" onclick="window.stopSession()" disabled class="control-btn danger" title="Close Avatar Session">
                    <i class="fas fa-power-off"></i>
                    <span>End Session</span>
                </button>
            </div>

            <!-- Video and Chat Container -->
            <div class="content-grid">
                <div class="video-section">
                    <div id="videoContainer" class="video-container">
                        <div id="localVideo" class="local-video" hidden>
                            <video src="{{ url_for('static', filename='video/lisa-casual-sitting-idle.mp4') }}" autoplay loop muted></video>
                        </div>
                        <div id="remoteVideo" class="remote-video"></div>
                        <div class="video-overlay">
                            <div class="overlay-top">
                                <div class="recording-indicator" id="recordingIndicator" style="display: none;">
                                    <i class="fas fa-circle"></i>
                                    <span>Recording</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chat-section">
                    <div class="chat-container">
                        <div class="chat-header">
                            <h3><i class="fas fa-comments"></i> Conversation</h3>
                            <div class="chat-controls">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showTypeMessage" onchange="window.updateTypeMessageBox()">
                                    <span class="slider"></span>
                                    <span class="label">Type Mode</span>
                                </label>
                            </div>
                        </div>
                        <div class="chat-history-container">
                            <div id="chatHistory" class="chat-history" contenteditable="false" hidden>
                                <!-- Chat messages will be dynamically added here -->
                            </div>
                        </div>
                        <div class="message-input-container">
                            <textarea id="userMessageBox" class="message-input" placeholder="Type your message here..." hidden></textarea>
                        </div>
                    </div>

                    <div class="logs-container">
                        <div class="logs-header">
                            <h4><i class="fas fa-chart-line"></i> Performance Logs</h4>
                        </div>
                        <textarea id="latencyLog" class="latency-log" readonly hidden></textarea>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
